## card setup: run/stop, gain, filter, samples/ch, sampling rate
## DIG - NSLS2: [PSy[:PI]][-SSy[:SI]][-TSy[:TI]]{Dev[:DI]}[SgN[:SgI][-SgD]]
#### Psy	-	Primary system
#### Ssy	-	Secondary system
#### Dev	-	Device name
## CARD   -	#digitizer; "0" is the first digitizer found during initialization.
##        For Acqiris crate and CPU, it's the top slot if there's one digitizer 
## NELM     -	max. number of samples per channel

record(mbbo,"${DIG}Run-Sel")
{   
   field(DESC,"setRunning")
   field(DTYP,"ics710SetRunning")
   field(OUT,"@C${CARD}")
   field(PINI,"YES")
   #field(ZRVL,"0")
   field(ZRST,"Stopped")
   #field(ONVL,"1")
   field(ONST,"Running")
   #info(autosaveFields_pass0, "RVAL")   
   info(autosaveFields_pass0, "VAL")  
}

record(mbbo,"${DIG}Gain-Sel")
{   
   field(DESC,"setGain")
   field(DTYP,"ics710SetGain")
   field(OUT,"@C${CARD}")
   field(PINI,"YES")
   field(UDF,"0")
   #field(ZRVL,"0")
   field(ZRST,"10V")
   #field(ONVL,"1")
   field(ONST,"5V")
   #field(TWVL,"2")
   field(TWST,"3.333V")
   #field(THVL,"3")
   field(THST,"2.5V")
   #field(FRVL,"4")
   field(FRST,"2V")
   #field(FVVL,"5")
   field(FVST,"1.667V")
   #field(SXVL,"6")
   field(SXST,"1.429V")
   #field(SVVL,"7")
   field(SVST,"1.25V")
   #field(EIVL,"8")
   field(EIST,"1.111V")
   #field(NIVL,"9")
   field(NIST,"1V")
   #field(TEVL,"10")
   field(TEST,"0.909V")
   #field(ELVL,"11")
   field(ELST,"0.833V")
   #field(TVVL,"12")
   field(TVST,"0.769V")
   #field(TTVL,"13")
   field(TTST,"0.714V")
   #field(FTVL,"14")
   field(FTST,"0.667V")
   #field(FFVL,"15")
   field(FFST,"0.625V")
   info(autosaveFields_pass0, "VAL")  
   field(FLNK,"${DIG}Gain-RB")  
}

record(mbbi,"${DIG}Gain-RB")
{   
   field(DESC,"getGain")
   field(DTYP,"ics710GetGain")
   field(INP,"@C${CARD}")
   #no need to specify **VL field
   #field(ONVL,"0")
   field(ZRST,"10V")
   field(ONST,"5V")
   field(TWST,"3.333V")
   field(THST,"2.5V")
   field(FRST,"2V")
   field(FVST,"1.667V")
   field(SXST,"1.429V")
   field(SVST,"1.25V")
   field(EIST,"1.111V")
   field(NIST,"1V")
   field(TEST,"0.909V")
   field(ELST,"0.833V")
   field(TVST,"0.769V")
   field(TTST,"0.714V")
   field(FTST,"0.667V")
   field(FFST,"0.625V")
}

record(mbbo,"${DIG}Filter-Sel")
{   
   field(DESC,"setFilter")
   field(DTYP,"ics710SetFilter")
   field(OUT,"@C${CARD}")
   field(PINI,"YES")
   field(VAL,"1")
   field(ONVL,"1")
   field(ONST,"10KHz")
   field(TWVL,"2")
   field(TWST,"20KHz")
   field(THVL,"3")
   field(THST,"30KHz")
   field(FRVL,"4")
   field(FRST,"40KHz")
   field(FVVL,"5")
   field(FVST,"50KHz")
   field(SXVL,"6")
   field(SXST,"60KHz")
   field(SVVL,"7")
   field(SVST,"70KHz")
   field(EIVL,"8")
   field(EIST,"80KHz")
   field(NIVL,"9")
   field(NIST,"90KHz")
   field(TEVL,"10")
   field(TEST,"100KHz")
   field(ELVL,"11")
   field(ELST,"110KHz")
   field(TVVL,"12")
   field(TVST,"120KHz")
   field(TTVL,"13")
   field(TTST,"130KHz")
   field(FTVL,"14")
   field(FTST,"140KHz")
   field(FFVL,"15")
   field(FFST,"150KHz")
   info(autosaveFields_pass0, "VAL") 
   field(FLNK,"${DIG}Filter-RB")
}

record(mbbi,"${DIG}Filter-RB")
{   
   field(DESC,"getFilter")
   field(DTYP,"ics710GetFilter")
   field(INP,"@C${CARD}")
   #no need to specify **VL field
   #field(ONVL,"1")
   field(ONST,"10KHz")
   field(TWST,"20KHz")
   field(THST,"30KHz")
   field(FRST,"40KHz")
   field(FVST,"50KHz")
   field(SXST,"60KHz")
   field(SVST,"70KHz")
   field(EIST,"80KHz")
   field(NIST,"90KHz")
   field(TEST,"100KHz")
   field(ELST,"110KHz")
   field(TVST,"120KHz")
   field(TTST,"130KHz")
   field(FTST,"140KHz")
   field(FFST,"150KHz")
}

record(mbbo,"${DIG}Osr-Sel")
{   
   field(DESC,"setOverSamplingRatio")
   field(DTYP,"ics710SetOsr")
   field(OUT,"@C${CARD}")
   field(PINI,"YES")
   #field(RVAL, "2")
   field(ZRVL,"0")
   field(ZRST,"Normal")
   field(ONVL,"1")
   field(ONST,"Double")
   field(TWVL,"2")
   field(TWST,"Quad")
   info(autosaveFields_pass0, "VAL")
   field(FLNK, "${DIG}Osr-RB")   
}

record(mbbi,"${DIG}Osr-RB")
{   
   field(DESC,"getOverSamplingRatio")
   field(DTYP,"ics710GetOsr")
   field(INP,"@C${CARD}")
   field(ZRVL,"0")
   field(ZRST,"Normal")
   field(ONVL,"1")
   field(ONST,"Double")
   field(TWVL,"2")
   field(TWST,"Quad")
   #reconfigure the samplingRate: trigger the record to be processed
   field(FLNK, "${DIG}SampleRate-SP")
}

record(mbbo,"${DIG}TrigMode-Sel")
{   
   field(DESC,"setTrigMode")
   field(DTYP,"ics710SetTrigMode")
   field(OUT,"@C${CARD}")
   field(PINI,"YES")
   field(VAL, "0")
   field(ZRVL,"0")
   field(ZRST,"Internal")
   field(ONVL,"1")
   field(ONST,"External")
   info(autosaveFields_pass0, "VAL")
   field(FLNK, "${DIG}TrigMode-RB")
}

record(mbbi,"${DIG}TrigMode-RB")
{   
   field(DESC,"getTrigMode")
   field(DTYP,"ics710GetTrigMode")
   field(INP,"@C${CARD}")
   field(ZRVL,"0")
   field(ZRST,"Internal")
   field(ONVL,"1")
   field(ONST,"External")
}

record(mbbo,"${DIG}AcqMode-Sel")
{   
   field(DESC,"setAcquisitionMode")
   field(DTYP,"ics710SetAcqMode")
   field(OUT,"@C${CARD}")
   field(PINI,"YES")
   field(VAL, "1")
   field(ZRVL,"0")
   field(ZRST,"Continuous")
   field(ONVL,"1")
   field(ONST,"CaptureNoPreTrig")
   field(TWVL,"2")
   field(TWST,"CaptureWithPreTrig")
   info(autosaveFields_pass0, "VAL")
   field(FLNK, "${DIG}AcqMode-RB")
}

record(mbbi,"${DIG}AcqMode-RB")
{   
   field(DESC,"getAcquisitionMode")
   field(DTYP,"ics710GetAcqMode")
   field(INP,"@C${CARD}")
   field(ZRVL,"0")
   field(ZRST,"Continuous")
   field(ONVL,"1")
   field(ONST,"CaptureNoPreTrig")
   field(TWVL,"2")
   field(TWST,"CaptureWithPreTrig")
}

record(longout,"${DIG}Samples-SP")
{
   field(DESC,"setSamples")
   field(DTYP,"ics710SetSamples")
   field(OUT,"@C${CARD}")
   field(PINI,"YES")
   #field(DOL, "10000")
   field(VAL, "1000")
   field(DRVH, "${NELM}")
   field(DRVL, "1")
   field(HOPR, "${NELM}")
   field(LOPR, "1")
   field(EGU, "samples")
   info(autosaveFields_pass0, "VAL")
   field(FLNK, "${DIG}Samples-RB")
}

record(longin,"${DIG}Samples-RB")
{
   field(DESC,"getSamples")
   field(DTYP,"ics710GetSamples")
   field(INP,"@C${CARD}")
   field(EGU, "samples")
   field(FLNK,"${DIG}SampleLength-I")
}

record(longin,"${DIG}ReadErrors-I")
{
   field(DESC,"ReadErrors")
   field(SCAN,"I/O Intr")
   field(DTYP,"ics710GetReadErrors")
   field(INP,"@C${CARD}")
}

record(longin,"${DIG}Timeouts-I")
{
   field(DESC,"timeouts")
   field(SCAN,"I/O Intr")
   field(DTYP,"ics710GetTimeouts")
   field(INP,"@C${CARD}")
}

record(ao,"${DIG}SampleRate-SP")
{
   field(DESC,"setSamplingRate")
   field(DTYP,"ics710SetSampleRate")
   field(OUT,"@C${CARD}")
   field(PINI,"YES")
   #field(DOL, "200")
   field(HOPR, "216")
   field(LOPR, "1")
   field(DRVH, "216")
   field(DRVL, "1")
   field(PREC,"3")
   field(EGU, "KHz") 
   info(autosaveFields_pass0, "VAL")  
   field(FLNK,"${DIG}SampleRate-RB")
}

record(ai,"${DIG}SampleRate-RB")
{
   field(DESC,"getSamplingRate")
   field(DTYP,"ics710GetSampleRate")
   field(INP,"@C${CARD}")
   field(EGU, "KHz") 
   field(PREC,"3")
   field(FLNK,"${DIG}SampleLength-I")
}

record(calc,"${DIG}SampleLength-I")
{
   field(DESC,"Sample length:ms")
   field(INPA,"${DIG}SampleRate-SP")
   field(INPB,"${DIG}Samples-SP")
   field(CALC, "(B*1.00)/A")  
   field(EGU,"ms")
   field(FLNK,"${DIG}TimeAxis-aSub_")
}

record(aSub,"${DIG}TimeAxis-aSub_")
{
    field(DESC,"construct time axis")
    #field(INAM,"initTimeAxis")
    field(SNAM,"createTimeAxis")
    #get samples/data points
    field (INPA, "${DIG}Samples-SP")
    field (FTA, "ULONG")
    field (NOA, "1")
    #get sample length (ms) 
    field (INPB, "${DIG}SampleLength-I")
    field (FTB, "DOUBLE")
    field (NOB, "1")
    #waveform data for time axis             
    field (OUTA, "${DIG}TimeAxis-Wf PP")
    field (FTVA, "DOUBLE")
    field (NOVA, "${NELM}")
}

record(waveform,"${DIG}TimeAxis-Wf")
{
   field(DESC,"Time axis: ms unit")
   field(NELM,"${NELM}")
   field(FTVL,"DOUBLE")
   field(INP,"${DIG}TimeAxis-aSub_.VALA")
   field(PREC,"3")
   field(EGU,"ms")
}

record(ai,"${DIG}TrigRate-I")
{
    field(DESC,"trigger rate or IOC update rate")
    field(SCAN,"I/O Intr")
    field(DTYP,"ics710GetTrigRate")
    field(INP,"@C${CARD}")
    field(PREC,"4")
    field(EGU,"Hz")
}
